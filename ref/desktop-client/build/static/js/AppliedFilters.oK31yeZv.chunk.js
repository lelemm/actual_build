import{j as t,db as T,r as m,a6 as x,bQ as Z,T as w,t as g,dc as J,V as h,dd as G,de as K,df as b,dg as O,d1 as X,bk as ee,dh as te,di as L,bV as re,as as ne,s as se,ab as F,aa as ae,cH as $,dj as le,a5 as j,an as oe,aw as ie,dk as V,dl as M,dm as ce,cL as A,f as B,d as ue,dn as de,dp as fe,dq as pe,i as ye}from"./index.15_rIw78.js";const Y=e=>t.jsx("svg",{...e,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",style:{color:"inherit",...e.style},children:t.jsx("path",{d:"m12 12 8-8V0H0v4l8 8v8l4-4v-4z",fill:"currentColor"})});var ge=Array.isArray,me=ge,he=typeof T=="object"&&T&&T.Object===Object&&T,xe=he,be=xe,je=typeof self=="object"&&self&&self.Object===Object&&self,ve=be||je||Function("return this")(),we=ve,Te=we,Se=Te.Symbol,R=Se,D=R,H=Object.prototype,Oe=H.hasOwnProperty,ke=H.toString,v=D?D.toStringTag:void 0;function Ce(e){var n=Oe.call(e,v),r=e[v];try{e[v]=void 0;var a=!0}catch{}var o=ke.call(e);return a&&(n?e[v]=r:delete e[v]),o}var Fe=Ce,$e=Object.prototype,Re=$e.toString;function Me(e){return Re.call(e)}var Ae=Me,E=R,Be=Fe,De=Ae,Ee="[object Null]",Ie="[object Undefined]",I=E?E.toStringTag:void 0;function _e(e){return e==null?e===void 0?Ie:Ee:I&&I in Object(e)?Be(e):De(e)}var Ne=_e;function Pe(e){return e!=null&&typeof e=="object"}var Ge=Pe,Le=Ne,Ve=Ge,Ye="[object Symbol]";function He(e){return typeof e=="symbol"||Ve(e)&&Le(e)==Ye}var We=He;function ze(e,n){for(var r=-1,a=e==null?0:e.length,o=Array(a);++r<a;)o[r]=n(e[r],r,e);return o}var Ue=ze,_=R,qe=Ue,Qe=me,Ze=We,Je=1/0,N=_?_.prototype:void 0,P=N?N.toString:void 0;function W(e){if(typeof e=="string")return e;if(Qe(e))return qe(e,W)+"";if(Ze(e))return P?P.call(e):"";var n=e+"";return n=="0"&&1/e==-Je?"-0":n}var Ke=W,Xe=Ke;function et(e){return e==null?"":Xe(e)}var ut=et;const tt=m.forwardRef(({onClick:e,style:n},r)=>t.jsx(x,{ref:r,type:"bare",onClick:e,"aria-label":"Menu",style:n,children:t.jsx(Z,{width:15,height:15,style:{transform:"rotateZ(90deg)"}})}));tt.displayName="MenuButton";function rt({conditionsOp:e,onChange:n,conditions:r}){return r.length>1?t.jsxs(w,{style:{color:g.pageText,marginTop:11,marginRight:5},children:[t.jsx(J,{style:{display:"inline-flex"},fields:[["and","all"],["or","any"]],value:e,onChange:(a,o)=>n(o,r)}),"of:"]}):t.jsx(h,{})}function nt({onClick:e}){return t.jsx(x,{type:"bare",onClick:e,children:t.jsx(Y,{width:15,height:15})})}function st({onClick:e}){return t.jsxs(x,{type:"bare",onClick:e,title:"Filters",children:[t.jsx(Y,{style:{width:12,height:12,marginRight:5}})," Filter"]})}function S({op:e,selected:n,style:r,onClick:a}){return t.jsx(x,{type:"bare",style:{backgroundColor:g.pillBackground,marginBottom:5,...r,...n&&{color:g.buttonNormalSelectedText,"&,:hover,:active":{backgroundColor:g.buttonNormalSelectedBackground,color:g.buttonNormalSelectedText}}},onClick:a,children:G(e)})}function z({field:e,options:n,value:r}){if(e==="date"&&typeof r=="string"){if(r.length===7)return"month";if(r.length===4)return"year"}if(e==="amount"){if(n&&n.inflow)return"amount-inflow";if(n&&n.outflow)return"amount-outflow"}return e}function at(e,n){let r;switch(e){case"amount":switch(n){case"amount-inflow":r={inflow:!0};break;case"amount-outflow":r={outflow:!0};break}break;case"date":switch(n){case"month":r={month:!0};break;case"year":r={year:!0};break}break}return r}function U(e,n){switch(n.type){case"set-op":{const r=b.get(e.field);let a=e.value;return(r==="id"||r==="string")&&(n.op==="contains"||n.op==="matches"||n.op==="is"||n.op==="doesNotContain"||n.op==="isNot")&&(a=null),{...e,op:n.op,value:a}}case"set-value":{const{value:r}=K(n.value,{type:b.get(e.field)});return{...e,value:r}}default:throw new Error(`Unhandled action type: ${n.type}`)}}let k=!1;const lt=["date","account","payee","notes","category","amount","cleared","reconciled","saved"].map(e=>[e,O(e)]);function q({field:e,initialSubfield:n=e,op:r,value:a,dispatch:o,onApply:c}){const[d,f]=m.useState(n),i=m.useRef(),y=m.useRef(null);m.useEffect(()=>{y.current!==r&&i.current&&i.current.focus(),y.current=r},[r]);const s=b.get(e);let u=L[s].ops.filter(l=>l!=="isbetween");return(d==="month"||d==="year")&&(u=["is"]),t.jsxs(le,{children:[t.jsx(h,{style:{marginBottom:10},children:t.jsxs(j,{direction:"row",align:"flex-start",children:[e==="amount"||e==="date"?t.jsx(oe,{options:e==="amount"?[["amount","Amount"],["amount-inflow","Amount (inflow)"],["amount-outflow","Amount (outflow)"]]:e==="date"?[["date","Date"],["month","Month"],["year","Year"]]:null,value:d,onChange:l=>{f(l),(l==="month"||l==="year")&&o({type:"set-op",op:"is"})}}):$(O(e)),t.jsx(h,{style:{flex:1}})]})}),t.jsx(h,{style:{color:g.pageTextLight,marginBottom:10},children:e==="saved"&&"Existing filters will be cleared"}),t.jsx(j,{direction:"row",align:"flex-start",spacing:1,style:{flexWrap:"wrap"},children:s==="boolean"?t.jsxs(t.Fragment,{children:[t.jsx(S,{op:"true",selected:a===!0,onClick:()=>{o({type:"set-op",op:"is"}),o({type:"set-value",value:!0})}},"true"),t.jsx(S,{op:"false",selected:a===!1,onClick:()=>{o({type:"set-op",op:"is"}),o({type:"set-value",value:!1})}},"false")]}):t.jsxs(t.Fragment,{children:[t.jsx(j,{direction:"row",align:"flex-start",spacing:1,style:{flexWrap:"wrap"},children:u.slice(0,3).map(l=>t.jsx(S,{op:l,selected:l===r,onClick:()=>o({type:"set-op",op:l})},l))}),t.jsx(j,{direction:"row",align:"flex-start",spacing:1,style:{flexWrap:"wrap"},children:u.slice(3,u.length).map(l=>t.jsx(S,{op:l,selected:l===r,onClick:()=>o({type:"set-op",op:l})},l))})]})}),t.jsxs("form",{action:"#",children:[s!=="boolean"&&t.jsx(ie,{inputRef:i,field:e,subfield:d,type:s==="id"&&(r==="contains"||r==="matches"||r==="doesNotContain")?"string":s,value:a,multi:r==="oneOf"||r==="notOneOf",style:{marginTop:10},onChange:l=>{o({type:"set-value",value:l})}}),t.jsxs(j,{direction:"row",justify:"flex-end",align:"center",style:{marginTop:15},children:[t.jsx(h,{style:{flex:1}}),t.jsx(x,{type:"primary",onClick:l=>{l.preventDefault(),c({field:e,op:r,value:a,options:at(e,d)})},children:"Apply"})]})]})]})}function dt({onApply:e,compact:n,hover:r,exclude:a}){const o=X(),c=m.useRef(null),d=ee()||"MM/dd/yyyy",[f,i]=m.useReducer((s,u)=>{switch(u.type){case"select-field":return{...s,fieldsOpen:!0,condOpen:!1};case"configure":{const{field:l}=te(u.field),p=b.get(l),Q=L[p].ops;return{...s,fieldsOpen:!1,condOpen:!0,field:u.field,op:Q[0],value:p==="boolean"?!0:null}}case"close":return{fieldsOpen:!1,condOpen:!1,value:null};default:return U(s,u)}},{fieldsOpen:!1,condOpen:!1,field:null,value:null});async function y(s){if(s=V({...s,type:b.get(s.field)}),s.type==="date"&&s.options){if(s.options.month){const p=M(s.value,ce(d),new Date);if(A(p))s.value=B(p,"yyyy-MM");else{alert("Invalid date format");return}}else if(s.options.year){const p=M(s.value,"yyyy",new Date);if(A(p))s.value=B(p,"yyyy");else{alert("Invalid date format");return}}}const{error:u}=s.field!=="saved"&&await ue("rule-validate",{conditions:[s],actions:[]}),l=o.find(p=>s.value===p.id);if(u&&u.conditionErrors.length>0){const p=$(O(s.field));alert(p+": "+de(u.conditionErrors[0]))}else e(l||s),i({type:"close"})}return re("f",()=>i({type:"select-field"}),{scopes:["app"]}),t.jsxs(h,{children:[t.jsx(h,{ref:c,children:t.jsx(ne,{style:{...se.tooltip,lineHeight:1.5,padding:"6px 10px"},content:t.jsx(w,{children:"Filters"}),placement:"bottom start",triggerProps:{isDisabled:!r},children:n?t.jsx(nt,{onClick:()=>i({type:"select-field"})}):t.jsx(st,{onClick:()=>i({type:"select-field"})})})}),t.jsx(F,{triggerRef:c,placement:"bottom start",isOpen:f.fieldsOpen,onOpenChange:()=>i({type:"close"}),"data-testid":"filters-select-tooltip",children:t.jsx(ae,{onMenuSelect:s=>{i({type:"configure",field:s})},items:lt.filter(s=>a?!a.includes(s[0]):!0).sort().map(([s,u])=>({name:s,text:$(u)}))})}),t.jsx(F,{triggerRef:c,placement:"bottom start",isOpen:f.condOpen,onOpenChange:()=>{i({type:"close"})},shouldCloseOnInteractOutside:s=>s.dataset.pikaYear?(k=!0,!1):k?(k=!1,!1):!0,style:{width:275,padding:15,color:g.menuItemText},"data-testid":"filters-menu-tooltip",children:f.field&&t.jsx(q,{field:f.field,op:f.op,value:f.value,dispatch:i,onApply:y})})]})}function ot({field:e,op:n,value:r,options:a,onSave:o,onClose:c}){const[d,f]=m.useReducer((i,y)=>{switch(y.type){case"close":return c(),i;default:return U(i,y)}},{field:e,op:n,value:r,options:a});return t.jsx(q,{field:d.field,initialSubfield:z({field:e,options:a,value:r}),op:d.op,value:d.value,options:d.options,dispatch:f,onApply:i=>{i=V({...i,type:b.get(i.field)}),o(i),c()}})}let C=!1;function it({field:e,customName:n,op:r,value:a,options:o,style:c,onChange:d,onDelete:f}){const[i,y]=m.useState(!1),s=m.useRef(null),u=z({field:e,value:a});return t.jsxs(h,{style:{backgroundColor:g.pillBackground,borderRadius:4,flexDirection:"row",alignItems:"center",marginRight:10,marginTop:10,...c},children:[t.jsx(x,{ref:s,type:"bare",disabled:n!=null,onClick:()=>y(!0),children:t.jsx("div",{style:{paddingBlock:1,paddingLeft:5,paddingRight:2},children:n?t.jsx(w,{style:{color:g.pageTextPositive},children:n}):t.jsxs(t.Fragment,{children:[t.jsx(w,{style:{color:g.pageTextPositive},children:O(u,o)})," ",t.jsx(w,{children:G(r,null)})," ",t.jsx(fe,{value:a,field:u,inline:!0,valueIsRaw:r==="contains"||r==="matches"||r==="doesNotContain"})]})})}),t.jsx(x,{type:"bare",onClick:f,"aria-label":"Delete filter",children:t.jsx(pe,{style:{width:8,height:8,margin:4}})}),t.jsx(F,{triggerRef:s,placement:"bottom start",isOpen:i,onOpenChange:()=>y(!1),shouldCloseOnInteractOutside:l=>l instanceof HTMLElement&&l.dataset.pikaYear?(C=!0,!1):C?(C=!1,!1):!0,style:{width:275,padding:15,color:g.menuItemText},"data-testid":"filters-menu-tooltip",children:t.jsx(ot,{field:e,op:r,value:u==="amount"&&typeof a=="number"?ye(a):a,options:o,onSave:d,onClose:()=>y(!1)})})]})}function ft({conditions:e,onUpdate:n,onDelete:r,conditionsOp:a,onConditionsOpChange:o}){return t.jsxs(h,{style:{flexDirection:"row",alignItems:"flex-start",flexWrap:"wrap"},children:[t.jsx(rt,{conditionsOp:a,onChange:o,conditions:e}),e.map((c,d)=>t.jsx(it,{customName:c.customName,field:c.field,op:c.op,value:c.value,options:c.options,onChange:f=>n(c,f),onDelete:()=>r(c)},d))]})}export{ft as A,dt as F,tt as M,Ne as _,We as a,we as b,Ge as c,R as d,xe as e,Ue as f,me as i,ut as t};
//# sourceMappingURL=AppliedFilters.oK31yeZv.chunk.js.map
